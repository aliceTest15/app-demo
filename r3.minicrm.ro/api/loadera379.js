if(typeof minicrm_loader!=="object"){minicrm_loader={BaseUrl:"",SetBaseUrl:function(Url){if(minicrm_loader.BaseUrl!="")return;matches=String(Url).toLowerCase().match(/(http|https):\/\/(.[^\/]+)\//i);minicrm_loader.BaseUrl=matches[0]},GetCookie:function(Name){var NameEQ=Name+"=",Cookies=document.cookie.split(";"),Cookie,i;for(i=0;i<Cookies.length;i++){Cookie=Cookies[i];while(Cookie.charAt(0)===" "){Cookie=Cookie.substring(1,Cookie.length)}if(Cookie.indexOf(NameEQ)===0){return unescape(Cookie.substring(NameEQ.length,Cookie.length))}}return null},GetDomain:function(Url){try{matches=String(Url).toLowerCase().match(/:\/\/(www\.)?(.[^\/]+)/i);if(matches){return matches[2]}}catch(err){minicrm.LogError(err,"Error on GetDomain with url: "+Url)}return""},GetReferrer:function(){var Referrer=this.GetCookie("minicrm_sr");if(Referrer)return Referrer;if(!document.referrer)return;var domain=minicrm_loader.GetDomain(document.location);var referrer_domain=String(document.referrer)?minicrm_loader.GetDomain(document.referrer):"";if(domain==referrer_domain)return;return document.referrer},BuildRequest:function(Url,Params){var Request=minicrm_loader.BaseUrl+Url;for(Name in Params){Request+=Request.indexOf("?")==-1?"?":"&";Request+=encodeURIComponent(Name)+"="+encodeURIComponent(Params[Name])}return Request},ParseQueryString:function(query){var Parsed={},tokens,idx;if(query==="")return Parsed;query=query.split("&");for(idx=0;idx<query.length;idx++){tokens=query[idx].split("=");switch(tokens.length){case 1:Parsed[unescape(tokens[0])]="";break;case 2:Parsed[unescape(tokens[0])]=unescape(tokens[1]);break;default:Parsed[unescape(tokens[0])]=undefined}}return Parsed},FindFormHash:function(ParsedQuery){var FormHash="";for(var Key in ParsedQuery){if(ParsedQuery[Key]==="")FormHash=Key}return FormHash},MessageHandler:function(e){if(!e.origin.match("minicrm"))return;var obj=JSON.parse(e.data);if(typeof obj!="object")return;if(obj.action=="sizing"){iframe=document.getElementById(obj.target);iframe.style.width="100%";iframe.style.height=40+parseInt(obj.height)+"px"}if(obj.action=="callback"){var sender=minicrm_loader.CreateSender(obj.FormHash);minicrm_loader.TopResponse(obj,sender)}},CreateSender:function(FormHash){var sender={};sender.SetResponse=function(ResponseObject){var iFrameId="MiniCRMFrame_"+FormHash;var iframe=document.getElementById(iFrameId);iframe.contentWindow.postMessage('{"action": "response", "FormHash": "'+FormHash+'", "response": '+JSON.stringify(ResponseObject)+"}",minicrm_loader.BaseUrl)};return sender},IFrameOnLoad:function(iFrameId,callback){var iframe=document.getElementById(iFrameId);var data='{"action": "sizing?", "target": "'+iFrameId+'"}';iframe.contentWindow.postMessage(data,minicrm_loader.BaseUrl);iframe.contentWindow.postMessage(callback,minicrm_loader.BaseUrl)},Init:function(){var scripts=document.getElementsByTagName("script");function _toConsumableArray(arr){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}var myScripts=[].concat(_toConsumableArray(scripts)).filter(function(x){return x.src.match(/minicrm.*\/loader\.js/)});var myScript=myScripts[myScripts.length-1];var Src=myScript.src.split("?");var ParsedSrc=minicrm_loader.ParseQueryString(Src[1]);var FormHash=minicrm_loader.FindFormHash(ParsedSrc);minicrm_loader.SetBaseUrl(Src[0]);var LocationSearch=window.location.search?window.location.search.substring(1):window.location.href.indexOf("?")!=-1?window.location.href.split("?")[1]:"";var Params=minicrm_loader.ParseQueryString(LocationSearch);var a=this.GetCookie("__utma");var z=this.GetCookie("__utmz");var r=this.GetReferrer();if(a)Params["__utma"]=encodeURIComponent(a);if(z)Params["__utmz"]=encodeURIComponent(z);if(r)Params["minicrm_sr"]=r;if(!Params["i"]&&ParsedSrc["i"]){Params["i"]=ParsedSrc["i"]}if(!Params["c"]&&ParsedSrc["c"]){Params["c"]=ParsedSrc["c"]}var iFrameId="MiniCRMFrame_"+FormHash;var iframe=document.createElement("iframe");var callback='{"action": "setcallback", "FormHash": "'+FormHash+'"}';if(iframe.attachEvent){iframe.attachEvent("onload",function(){minicrm_loader.IFrameOnLoad(iFrameId,callback)})}else{iframe.addEventListener("load",function(){minicrm_loader.IFrameOnLoad(iFrameId,callback)},false)}iframe.setAttribute("src",this.BuildRequest("Form-"+FormHash,Params));iframe.setAttribute("id",iFrameId);iframe.setAttribute("height","100%");iframe.setAttribute("width","100%");iframe.style.overflow="hidden";iframe.style.border="none";myScript.parentNode.appendChild(iframe);setTimeout(function(){},1e3)},InitOnce:function(){if(typeof JSON=="undefined"){var head=document.getElementsByTagName("head").item(0),js=document.createElement("script");js.setAttribute("language","javascript");js.setAttribute("type","text/javascript");js.setAttribute("async",false);js.setAttribute("src","https://r3.minicrm.hu/api/json2.js");head.appendChild(js)}if(typeof window.addEventListener!="undefined"){window.addEventListener("message",minicrm_loader.MessageHandler,false)}else if(typeof window.attachEvent!="undefined"){window.attachEvent("onmessage",minicrm_loader.MessageHandler)}},TopResponse:function(Response,Sender){if(!Response.Error&&Response.Url!=""){window.location.href=Response.Url;return}Sender.SetResponse(Response)}};minicrm_loader.InitOnce()}minicrm_loader.Init();
